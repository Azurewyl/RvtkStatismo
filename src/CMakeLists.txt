cmake_minimum_required(VERSION 2.6)
project(Rvtk)
set(VTK_DIR ".")
find_package(VTK REQUIRED)

## GET R-specific ENV variables
execute_process(COMMAND R RHOME OUTPUT_VARIABLE R_HOME OUTPUT_STRIP_TRAILING_WHITESPACE)
set(R "${R_HOME}/bin/R")
set (RSCRIPT "${R_HOME}/bin/Rscript")
execute_process(COMMAND ${RSCRIPT} -e "cat(paste0(Sys.getenv('R_INCLUDE_DIR')))" OUTPUT_VARIABLE RDIR)
execute_process(COMMAND ${RSCRIPT} -e "cat(system.file(package='Rcpp'))" OUTPUT_VARIABLE RCPP_DIR)
set(RCPP_DIR "${RCPP_DIR}/include")
execute_process(COMMAND ${R} CMD config CXX OUTPUT_VARIABLE CXX OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process(COMMAND ${R} CMD config CXXFLAGS OUTPUT_VARIABLE CXXFLAGS OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process(COMMAND ${R} CMD config CPPFLAGS OUTPUT_VARIABLE CPPFLAGS OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process(COMMAND ${R} CMD config BLAS_LIBS OUTPUT_VARIABLE BLAS_LIBS OUTPUT_STRIP_TRAILING_WHITESPACE)
execute_process(COMMAND ${R} CMD config LAPACK_LIBS OUTPUT_VARIABLE LAPACK_LIBS OUTPUT_STRIP_TRAILING_WHITESPACE)
#MESSAGE("${RSCRIPT}")

## set variables accordingly
set(CMAKE_CXX_FLAGS "${CXXFLAGS}")
set(CMAKE_C_FLAGS "${CPPFLAGS}")
SET( CMAKE_CXX_COMPILER "${CXX}")
SET(CMAKE_VERBOSE_MAKEFILE OFF)
SET(RLIB "${R_HOME}/lib")
LINK_DIRECTORIES(${RLIB})
include_directories(${RCPP_DIR} ${RDIR})
include(${VTK_USE_FILE})
add_library(Rvtk SHARED writeToVTK.cpp R2vtk.cpp testpoly.cpp vtkVisualize.cpp writeToVTK.cpp)
set(CMAKE_SHARED_LINKER_FLAGS "${BLAS_LIBS} ${LAPACK_LIBS}")
target_link_libraries(Rvtk ${VTK_LIBRARIES} R)
